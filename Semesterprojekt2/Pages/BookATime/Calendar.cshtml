@page
@using Semesterprojekt2.Service;
@using Semesterprojekt2.Service.BookATimeService;
@model Semesterprojekt2.Pages.BookATime.CalendarModel
@{
}

<html>
    <head>
        <style>
            table 
                {
                   width: 100%;
                   border-collapse: collapse;
                }

            td 
                {
                    border: 1px solid #ddd;
                    text-align: center;
                    padding: 8px;
                }


           .button-like-text 
                {
                    background: none; /* Fjerner baggrundsstil */
                    color: inherit; /* Arver tekstfarven fra omgivende element */
                    border: none; /* Fjerner rammen */
                    padding: 0; /* Fjerner padding */
                    font: inherit; /* Arver skriftstil */
                    cursor: pointer; /* Bevarer musepeger som klikbar */
                }

           .button-like-text:hover 
                {
                    text-decoration: underline; /* Tilføjer understregning ved hover for at indikere klikbarhed */
                }


           .orange-day 
                {
                    background-color: #FCC681;
                    color: dimgrey; /* White text for better readability */
                }

           .yellow-day 
                {
                    background-color:#F0E9AA;  
                    color: dimgrey; 
                }
                 .red-day
                {
                    background-color:#EAA193;
                    
                }

                    /* Røde: */ /* #EAA193 */
           .skrift-mellem-månederne 
                {
                    display: flex;
                    justify-content: space-between;

                }
            .Forrige-måned 
                {
    
                }
            .Næste-måned 
                {
    
                }
            h1
                {
                    text-align: center;
                }
            h2
                {
                    text-align: center;
                }
            .AltTekstIToppen
                {
                    display: flex;
                    justify-content: space-between;
                     align-items: center;
                    
                }
            .OBS
                {

                }
            .farvedag
                {
                }
            .År-Måned
                {
                }
            .past-day 
                {
                    color: dimgrey;
                    background-color: rgb(239,231,225); /* Or any other color that indicates non-selectability */
                }
                .Yellow
                {
                    background-color: #F0E9AA
                }
                .Orange
                {
                    background-color: #FCC681;
                }
                .Red
                {
                    background-color:#EAA193;
                    
                }
                .Skriftmellemmånderne
                {
                 background-color: rgb(239,231,225);
                  
                  border: none;
                     
                }
                .non-link 
                {
                    color: dimgray; /* or the color of your normal text */
                    text-decoration: none; /* removes underline */
                    cursor: pointer; /* Bevarer musepeger som klikbar */
                 }
                   .transparent-select 
                {
                    background-color: transparent; /* Gør baggrunden gennemsigtig */
                    border: none; /* Fjerner rammen */
                    color: black; /* Sætter tekstfarven til sort eller enhver farve der matcher baggrunden */
                    -webkit-appearance: none; /* Fjerner standard browser styling for WebKit-browsere */
                    -moz-appearance: none; /* Fjerner standard browser styling for Mozilla Firefox */
                    appearance: none; /* Fjerner standard browser styling */
                }
        </style>
    </head>
    <body>
        <h1>Book A Time</h1>
        <hr /> 
        <div class="År-Måned">
            <h2>@Model.MonthName @Model.Year</h2> 
        </div>
        <div class="AltTekstIToppen">
            <div class="farvedag">
               <p> 
                   <div class="Yellow"> 
                       Sat-Tue (Yellow): Mobile service. 
                   </div> 
                   <br /> 
                   <div class="Orange"> 
                       Wed-Fri (Orange): Salon.
                   </div> 
                   <br /> 
                   <div class="Red"> 
                       Red: The day is booked.
                   </div>
               </p>
            </div>  
            <div class="OBS">
                <p><b>NOTE!! I have both a store <br /> and a mobile service.</b></p>
            </div>
        </div>
       
        @* ? fungere som en kort form for en if-else sætning. 
        : Model.Year, hvis måneden ikke er december(plus)/januar(minus), vil det returnere Model.Year. Dette betyder, at hvis måneden ikke er december, forbliver årstallet uændret. *@
 
        <div class="skrift-mellem-månederne">
            <div class="Forrige-måned">
              <button class="Skriftmellemmånderne"> <a asp-page="/BookATime/Calendar" asp-route-Year="@(Model.Month == 1 ? Model.Year - 1 : Model.Year)" asp-route-Month="@(Model.Month == 1 ? 12 : Model.Month - 1)" class="non-link">Last Month</a></button> 
            </div>
            <div class="Næste-måned">
              <button class="Skriftmellemmånderne">  <a asp-page="/BookATime/Calendar" asp-route-Year="@(Model.Month == 12 ? Model.Year + 1 : Model.Year)" asp-route-Month="@(Model.Month == 12 ? 1 : Model.Month + 1)" class="non-link">Next Month</a></button>
      
            </div>
        </div>       
        <br />
         <table>
        @{
            int dayCounter = 0; // Initialize the counter for days in the week. hvorfor vi starter på 0?
            // Når man arbejder med tællere i programmering, starter man ofte fra 0 afhængigt af konteksten. Dette skyldes, at mange programmeringssprog og datamodeller bruger 0-baserede indeksering.
           
            DateTime today = DateTime.Today; 

           
        
    //         var bookedTimesDict = new Dictionary<DateTime, List<string>>();
           
    //          for (int day = 1; day <= DateTime.DaysInMonth(Model.Year, Model.Month); day++)
    // {
    //     var date = new DateTime(Model.Year, Model.Month, day);
    //     var bookedTimes = await TidsbestillingService.GetBookedTimesForDate(date);
    //     bookedTimesDict[date] = bookedTimes;
    // }

    
        }
       
        <tr>
            @foreach (var day in Model.DaysInMonth)
            {
              
            DateTime date = new DateTime(Model.Year, Model.Month, day);
            string dayClass = date < today ? "past-day" : (Model.DayClasses.ContainsKey(date) ? Model.DayClasses[date] : "");           
            var availableTimes = Model.AvailableTimesDict.ContainsKey(date) ? Model.AvailableTimesDict[date] : new List<string>();

                if (dayCounter == 7)
                {
                    // When there are 7 days, close the current row and start a new one
                    @: </tr><tr>
                    dayCounter = 0; // Reset the counter for the new row
                }
         
                @*    string dayClass = TidsbestillingService.GetDayClass(date); *@


                // Denne linje bestemmer CSS-klassen for en given dag. 
                // Hvis 'currentDate' repræsenterer en dato, der allerede er forbi (dvs. før 'today'), 
                // bliver 'dayClass' sat til "past-day".
                // Hvis 'currentDate' er i dag eller i fremtiden, hentes klassen ved at kalde 'GetDayClass' metoden.
             // Denne boolean ('isPast') er sand (true), hvis 'currentDate' er før 'today', hvilket indikerer 
                // at det er en dato i fortiden. Denne værdi bruges til at afgøre, om den tilsvarende dag 
                // skal kunne klikkes på eller ej i brugergrænsefladen.
                bool isPast = date < today;
             
               
                <td class="@dayClass">
                    @if (!isPast)
                    {

                        <form method="post">

                            <input type="hidden" name="Year" value="@Model.Year" />
                            <input type="hidden" name="Month" value="@Model.Month" />
                            <input type="hidden" name="Day" value="@day" />
                            
                           
                           
                        <select asp-for="Tidspunkt" required class="transparent-select">
                            @foreach(var time in availableTimes)
                            {
                            
                                <option value="@time">@time</option>
                                
                            }
                        </select> 
                        <br />
                        <button type="submit" class="button-like-text">@day</button>
                        </form>

                         
                       


                    }
                    else
                    {
                        @day
                    }
                </td>

                dayCounter++; // Increment the counter
            }
    
            @if (dayCounter > 0)
            {
                // Close the last row if it's not empty
        <tr> </tr>
            }
      
    </table>
              
     <a class="btn btn-primary btn-sm" type="button" data-toggle="tooltip" title="Edit" asp-page="BookedDays/CreateBookedDays"> <i class="fa fa-edit"></i></a>
                
                             <a class="btn btn-danger btn-sm " type="button" data-toggle="tooltip" title="Info" asp-page="BookedDays/BookedDays"><i class="fa fa-info"></i></a>
 @* Første forsøg!! gem hvis noget går forkert
     <table>
        @{
            int dayCounter = 0; // Initialize the counter for days in the week. hvorfor vi starter på 0?
            // Når man arbejder med tællere i programmering, starter man ofte fra 0 afhængigt af konteksten. Dette skyldes, at mange programmeringssprog og datamodeller bruger 0-baserede indeksering.
            DateTime today = DateTime.Today; 

           
        }
       
        <tr>
            @foreach (var day in Model.DaysInMonth)
            {
                if (dayCounter == 7)
                {
                    // When there are 7 days, close the current row and start a new one
                    @: </tr><tr>
                    dayCounter = 0; // Reset the counter for the new row
                }
                
                DateTime currentDate = new DateTime(Model.Year, Model.Month, day);

                // Denne linje bestemmer CSS-klassen for en given dag. 
                // Hvis 'currentDate' repræsenterer en dato, der allerede er forbi (dvs. før 'today'), 
                // bliver 'dayClass' sat til "past-day". 
                // Hvis 'currentDate' er i dag eller i fremtiden, hentes klassen ved at kalde 'GetDayClass' metoden.

                 string dayClass = currentDate < today ? "past-day" : BookATimeService.GetDayClass(currentDate);

                // Denne boolean ('isPast') er sand (true), hvis 'currentDate' er før 'today', hvilket indikerer 
                // at det er en dato i fortiden. Denne værdi bruges til at afgøre, om den tilsvarende dag 
                // skal kunne klikkes på eller ej i brugergrænsefladen.

                bool isPast = currentDate < today;
                <td class="@dayClass">
                    @if (!isPast)
                    {
                        <form method="get" asp-page="/BookATime/BookATime">

                            <input type="hidden" name="Year" value="@Model.Year" />
                            <input type="hidden" name="Month" value="@Model.Month" />
                            <input type="hidden" name="Day" value="@day" />
                            <button type="submit" class="button-like-text">@day</button>
                        </form>
                    }
                    else
                    {
                        @day
                    }
                </td>

                dayCounter++; // Increment the counter
            }
    
            @if (dayCounter > 0)
            {
                // Close the last row if it's not empty
        <tr> </tr>
            }
      
    </table> *@
       

  </body>
</html>